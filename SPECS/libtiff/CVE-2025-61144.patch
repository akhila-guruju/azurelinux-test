From d81d8d12a6a050865e09ed1e982a895994ba0dc0 Mon Sep 17 00:00:00 2001
From: Lee Howard <faxguy@howardsilvan.com>
Date: Fri, 5 Sep 2025 13:01:12 -0700
Subject: [PATCH] avoid buffer overflow in tiffcrop #740

Signed-off-by: Azure Linux Security Servicing Account <azurelinux-security@microsoft.com>
Upstream-reference: https://gitlab.com/libtiff/libtiff/-/merge_requests/757.patch
---
 archive/tools/tiffcrop.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/archive/tools/tiffcrop.c b/archive/tools/tiffcrop.c
index f69efa8..998c6ab 100644
--- a/archive/tools/tiffcrop.c
+++ b/archive/tools/tiffcrop.c
@@ -4375,7 +4375,7 @@ static int combineSeparateSamplesBytes(unsigned char *srcbuffs[],
     {
         if ((dumpfile != NULL) && (level == 2))
         {
-            for (s = 0; s < spp; s++)
+            for (s = 0; (s < spp) && (s < MAX_SAMPLES); s++)
             {
                 dump_info(dumpfile, format, "combineSeparateSamplesBytes",
                           "Input data, Sample %" PRIu16, s);
-- 
2.45.4

